version: "3.9"

services:
  # ğŸ§© SQL Server Database
  sqlserver:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: sqlserver
    platform: linux/amd64
    environment:
      SA_PASSWORD: "Strong!Passw0rd"
      ACCEPT_EULA: "Y"
      MSSQL_PID: "Express"
    ports:
      - "1433:1433"
    volumes:
      - sql_data:/var/opt/mssql        # âœ… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¨Ù‚Ù‰ Ù…Ø­ÙÙˆØ¸Ø© Ù‡Ù†Ø§
    networks:
      - burger-network
    healthcheck:                       # âœ… ÙØ­Øµ Ø¨Ø³ÙŠØ· Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ SQL
      test: ["CMD-SHELL", "pgrep sqlservr > /dev/null || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5

  # ğŸ§  Backend (Spring Boot)
  backend:
    build: ./backend
    container_name: burger-backend
    platform: linux/amd64
    depends_on:
      sqlserver:
        condition: service_healthy
    environment:
      SPRING_DATASOURCE_URL: "jdbc:sqlserver://sqlserver:1433;databaseName=BurgerDB;encrypt=false;trustServerCertificate=true;"
      SPRING_DATASOURCE_USERNAME: "sa"
      SPRING_DATASOURCE_PASSWORD: "Strong!Passw0rd"
      SPRING_JPA_HIBERNATE_DDL_AUTO: "update"
      SERVER_PORT: 8080
      CORS_ALLOWED_ORIGINS: "http://localhost:5173"
    ports:
      - "8080:8080"
    networks:
      - burger-network

  # ğŸ¨ Frontend (React + Vite)
  frontend:
    build: ./frontend
    container_name: burger-frontend
    platform: linux/amd64
    depends_on:
      - backend
    environment:
      VITE_API_BASE_URL: "http://backend:8080/api"
    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port 5173"
    ports:
      - "5173:5173"
    networks:
      - burger-network

# ğŸ’¾ Volume Ø¯Ø§Ø¦Ù… Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
volumes:
  sql_data:

# ğŸŒ Ø´Ø¨ÙƒØ© Ù…Ø´ØªØ±ÙƒØ© Ø¨ÙŠÙ† ÙƒÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª
networks:
  burger-network:
    driver: bridge

